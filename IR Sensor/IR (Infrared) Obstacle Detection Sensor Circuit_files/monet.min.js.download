!function(name,context,definition){context[name]=definition()}("reqwest",this,function(){var context=this;if("document"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2");}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix=
"reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(a){return a instanceof Array},defaultHeaders={"contentType":"application/x-www-form-urlencoded","requestedWith":xmlHttpRequest,"accept":{"*":"text/javascript, text/html, application/xml, text/xml, */*","xml":"application/xml, text/xml","html":"text/html","text":"text/plain","json":"application/json, text/javascript","js":"application/javascript, text/javascript"}},
xhr=function(o){if(o["crossOrigin"]===true){var xhr=context[xmlHttpRequest]?new XMLHttpRequest:null;if(xhr&&"withCredentials"in xhr)return xhr;else if(context[xDomainRequest]){var protocolRegExp=/^https?/;if(window.location.href.match(protocolRegExp)[0]!==o.url.match(protocolRegExp)[0])throw new Error("XDomainRequest: requests must be targeted to the same scheme as the hosting page.");return new XDomainRequest}else throw new Error("Browser does not support cross-origin requests");}else if(context[xmlHttpRequest])return new XMLHttpRequest;
else if(XHR2)return new XHR2;else return new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(data){return data}};function succeed(r){var protocol=protocolRe.exec(r.url);protocol=protocol&&protocol[1]||context.location.protocol;return httpsRe.test(protocol)?twoHundo.test(r.request.status):!!r.request.response}function handleReadyState(r,success,error){return function(){if(r._aborted)return error(r.request);if(r._timedOut)return error(r.request,"Request is aborted: timeout");
if(r.request&&r.request[readyState]==4){r.request.onreadystatechange=noop;if(succeed(r))success(r.request);else error(r.request)}}}function setHeaders(http,o){var headers=o["headers"]||{},h;headers["Accept"]=headers["Accept"]||(defaultHeaders["accept"][o["type"]]||defaultHeaders["accept"]["*"]);var isAFormData=typeof FormData!=="undefined"&&o["data"]instanceof FormData;if(!headers[contentType]&&!isAFormData)headers[contentType]=o["contentType"]||defaultHeaders["contentType"];for(h in headers)headers.hasOwnProperty(h)&&
("setRequestHeader"in http&&http.setRequestHeader(h,headers[h]))}function setCredentials(http,o){if(typeof o["withCredentials"]!=="undefined"&&typeof http.withCredentials!=="undefined")http.withCredentials=!!o["withCredentials"]}function generalCallback(data){lastValue=data}function urlappend(url,s){return url+(/\?/.test(url)?"\x26":"?")+s}function handleJsonp(o,fn,err,url){var reqId=uniqid++,cbkey=o["jsonpCallback"]||"callback",cbval=o["jsonpCallbackName"]||reqwest.getcallbackPrefix(reqId),cbreg=
new RegExp("((^|\\?|\x26)"+cbkey+")\x3d([^\x26]+)"),match=url.match(cbreg),script=doc.createElement("script"),loaded=0,isIE10=navigator.userAgent.indexOf("MSIE 10.0")!==-1;if(match)if(match[3]==="?")url=url.replace(cbreg,"$1\x3d"+cbval);else cbval=match[3];else url=urlappend(url,cbkey+"\x3d"+cbval);context[cbval]=generalCallback;script.type="text/javascript";script.src=url;script.async=true;if(typeof script.onreadystatechange!=="undefined"&&!isIE10)script.htmlFor=script.id="_reqwest_"+reqId;script.onload=
script.onreadystatechange=function(){if(script[readyState]&&(script[readyState]!=="complete"&&script[readyState]!=="loaded")||loaded)return false;script.onload=script.onreadystatechange=null;script.onclick&&script.onclick();fn(lastValue);lastValue=undefined;head.removeChild(script);loaded=1};head.appendChild(script);return{abort:function(){script.onload=script.onreadystatechange=null;err({},"Request is aborted: timeout",{});lastValue=undefined;head.removeChild(script);loaded=1}}}function getRequest(fn,
err){var o=this.o,method=(o["method"]||"GET").toUpperCase(),url=typeof o==="string"?o:o["url"],data=o["processData"]!==false&&(o["data"]&&typeof o["data"]!=="string")?reqwest.toQueryString(o["data"]):o["data"]||null,http,sendWait=false;if((o["type"]=="jsonp"||method=="GET")&&data){url=urlappend(url,data);data=null}if(o["type"]=="jsonp")return handleJsonp(o,fn,err,url);http=o.xhr&&o.xhr(o)||xhr(o);http.open(method,url,o["async"]===false?false:true);setHeaders(http,o);setCredentials(http,o);if(context[xDomainRequest]&&
http instanceof context[xDomainRequest]){http.onload=fn;http.onerror=err;http.onprogress=function(){};sendWait=true}else http.onreadystatechange=handleReadyState(this,fn,err);o["before"]&&o["before"](http);if(sendWait)setTimeout(function(){http.send(data)},200);else http.send(data);return http}function Reqwest(o,fn){this.o=o;this.fn=fn;init.apply(this,arguments)}function setType(header){if(header===null)return undefined;if(header.match("json"))return"json";if(header.match("javascript"))return"js";
if(header.match("text"))return"html";if(header.match("xml"))return"xml"}function init(o,fn){this.url=typeof o=="string"?o:o["url"];this.timeout=null;this._fulfilled=false;this._successHandler=function(){};this._fulfillmentHandlers=[];this._errorHandlers=[];this._completeHandlers=[];this._erred=false;this._responseArgs={};var self=this;fn=fn||function(){};if(o["timeout"])this.timeout=setTimeout(function(){timedOut()},o["timeout"]);if(o["success"])this._successHandler=function(){o["success"].apply(o,
arguments)};if(o["error"])this._errorHandlers.push(function(){o["error"].apply(o,arguments)});if(o["complete"])this._completeHandlers.push(function(){o["complete"].apply(o,arguments)});function complete(resp){o["timeout"]&&clearTimeout(self.timeout);self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(resp)}function success(resp){var type=o["type"]||resp&&setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,
type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case "json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case "js":resp=eval(r);break;case "html":resp=r;break;case "xml":resp=resp.responseXML&&(resp.responseXML.parseError&&(resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason))?null:resp.responseXML;break}self._responseArgs.resp=resp;self._fulfilled=true;fn(resp);
self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=true;self.request.abort()}function error(resp,msg,t){resp=self.request;self._responseArgs.resp=resp;self._responseArgs.msg=msg;self._responseArgs.t=t;self._erred=true;while(self._errorHandlers.length>0)self._errorHandlers.shift()(resp,msg,t);complete(resp)}this.request=getRequest.call(this,success,error)}Reqwest.prototype={abort:function(){this._aborted=
true;this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(success,fail){success=success||function(){};fail=fail||function(){};if(this._fulfilled)this._responseArgs.resp=success(this._responseArgs.resp);else if(this._erred)fail(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t);else{this._fulfillmentHandlers.push(success);this._errorHandlers.push(fail)}return this},always:function(fn){if(this._fulfilled||this._erred)fn(this._responseArgs.resp);else this._completeHandlers.push(fn);
return this},fail:function(fn){if(this._erred)fn(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t);else this._errorHandlers.push(fn);return this},"catch":function(fn){return this.fail(fn)}};function reqwest(o,fn){return new Reqwest(o,fn)}function normalize(s){return s?s.replace(/\r?\n/g,"\r\n"):""}function serial(el,cb){var n=el.name,t=el.tagName.toLowerCase(),optCb=function(o){if(o&&!o["disabled"])cb(n,normalize(o["attributes"]["value"]&&o["attributes"]["value"]["specified"]?o["value"]:
o["text"]))},ch,ra,val,i;if(el.disabled||!n)return;switch(t){case "input":if(!/reset|button|image|file/i.test(el.type)){ch=/checkbox/i.test(el.type);ra=/radio/i.test(el.type);val=el.value;(!(ch||ra)||el.checked)&&cb(n,normalize(ch&&val===""?"on":val))}break;case "textarea":cb(n,normalize(el.value));break;case "select":if(el.type.toLowerCase()==="select-one")optCb(el.selectedIndex>=0?el.options[el.selectedIndex]:null);else for(i=0;el.length&&i<el.length;i++)el.options[i].selected&&optCb(el.options[i]);
break}}function eachFormElement(){var cb=this,e,i,serializeSubtags=function(e,tags){var i,j,fa;for(i=0;i<tags.length;i++){fa=e[byTag](tags[i]);for(j=0;j<fa.length;j++)serial(fa[j],cb)}};for(i=0;i<arguments.length;i++){e=arguments[i];if(/input|select|textarea/i.test(e.tagName))serial(e,cb);serializeSubtags(e,["input","select","textarea"])}}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var hash={};eachFormElement.apply(function(name,
value){if(name in hash){hash[name]&&(!isArray(hash[name])&&(hash[name]=[hash[name]]));hash[name].push(value)}else hash[name]=value},arguments);return hash}reqwest.serializeArray=function(){var arr=[];eachFormElement.apply(function(name,value){arr.push({name:name,value:value})},arguments);return arr};reqwest.serialize=function(){if(arguments.length===0)return"";var opt,fn,args=Array.prototype.slice.call(arguments,0);opt=args.pop();opt&&(opt.nodeType&&(args.push(opt)&&(opt=null)));opt&&(opt=opt.type);
if(opt=="map")fn=serializeHash;else if(opt=="array")fn=reqwest.serializeArray;else fn=serializeQueryString;return fn.apply(null,args)};reqwest.toQueryString=function(o,trad){var prefix,i,traditional=trad||false,s=[],enc=encodeURIComponent,add=function(key,value){value="function"===typeof value?value():value==null?"":value;s[s.length]=enc(key)+"\x3d"+enc(value)};if(isArray(o))for(i=0;o&&i<o.length;i++)add(o[i]["name"],o[i]["value"]);else for(prefix in o)if(o.hasOwnProperty(prefix))buildParams(prefix,
o[prefix],traditional,add);return s.join("\x26").replace(/%20/g,"+")};function buildParams(prefix,obj,traditional,add){var name,i,v,rbracket=/\[\]$/;if(isArray(obj))for(i=0;obj&&i<obj.length;i++){v=obj[i];if(traditional||rbracket.test(prefix))add(prefix,v);else buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}else if(obj&&obj.toString()==="[object Object]")for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add);else add(prefix,obj)}reqwest.getcallbackPrefix=
function(){return callbackPrefix};reqwest.compat=function(o,fn){if(o){o["type"]&&((o["method"]=o["type"])&&delete o["type"]);o["dataType"]&&(o["type"]=o["dataType"]);o["jsonpCallback"]&&((o["jsonpCallbackName"]=o["jsonpCallback"])&&delete o["jsonpCallback"]);o["jsonp"]&&(o["jsonpCallback"]=o["jsonp"])}return new Reqwest(o,fn)};reqwest.ajaxSetup=function(options){options=options||{};for(var k in options)globalSetupOptions[k]=options[k]};return reqwest});"use strict";
var Monet=function(){var DEFAULT_COMPONENT_LOCALE="en";var MAX_LOGGING_PAYLOAD_SIZE=230*1024;var MAX_LOGGED_EVENT_BATCH_LENGTH=10;var EventLoggingSamplingRatios={MONET_RESOURCE_TIMING:1,MONET_STUDIO_EVENT:1};var endPoint="";var loggerEndPoint="";var backupLocationBase="";var test=false,nflxLog=true,excluded=false,local=false;var enabler;var monetImpressionId="";var serverCacheBust=false;var cachedDynamicAssets=null;var _queryString={},_enablerAdParams={};var pendingInitCallbacks=[];var pendingLogs=
[];var impressionTime=null;function parseURL(url){var urlParserLink=document.createElement("a");urlParserLink.href=url;var searchKVPairs=[];var search=urlParserLink.search.replace(/^\?/,"");if(!!search)searchKVPairs=search.split("\x26").map(function(kvPair){var parts=kvPair.split("\x3d").map(function(part){return decodeURIComponent(part)});return{key:parts[0],value:parts[1]}});return{protocol:urlParserLink.protocol,username:urlParserLink.username,password:urlParserLink.password,host:urlParserLink.host,
pathname:urlParserLink.pathname,searchParams:searchKVPairs,hash:urlParserLink.hash}}function addOrUpdateURLParameter(url,paramKey,paramValue){paramKey=decodeURIComponent(paramKey);paramValue=decodeURIComponent(paramValue);if(!!self.URL&&!!self.URLSearchParams){var parsedURL=new URL(url);parsedURL.searchParams.set(paramKey,paramValue);return parsedURL.toString()}var parsedURL=parseURL(url);var searchKVPairs=parsedURL.searchParams;var existingMatchingKVPair=searchKVPairs.filter(function(kvPair){return kvPair.key===
paramKey});if(existingMatchingKVPair.length>0)existingMatchingKVPair[0].value=paramValue;else searchKVPairs.push({key:paramKey,value:paramValue});var updatedSearch="?"+searchKVPairs.map(function(kvPair){return[encodeURIComponent(kvPair.key),encodeURIComponent(kvPair.value)].join("\x3d")}).join("\x26");var credentials="";if(!!parsedURL.username||!!parsedURL.password)credentials=parsedURL.username+":"+parsedURL.password+"@";var pathname=parsedURL.pathname;if(pathname[0]!=="/")pathname="/"+pathname;
return parsedURL.protocol+"//"+credentials+parsedURL.host+pathname+updatedSearch+parsedURL.hash}var objectTrimmer=function(){function computeObjectSerializedSize(serializedObject){return(new Blob([serializedObject],{type:"text/plain"})).size}function reduceObjectSerializedSize(object,maxValueSizeBytes,droppedValuePlaceholder){var primitives=[];var serializedObject=JSON.stringify(object,function(key,value){if(typeof value!=="object")primitives.push(value);return value});var serializedSize=computeObjectSerializedSize(serializedObject);
if(serializedSize<=maxValueSizeBytes)return object;var placeholderSize=computeObjectSerializedSize(JSON.stringify(droppedValuePlaceholder));var sizedPrimitives=primitives.map(function(primitiveValue){return{primitiveValue:primitiveValue,serializedSize:computeObjectSerializedSize(JSON.stringify(primitiveValue))}});sizedPrimitives.sort(function(sizedPrimitiveA,sizedPrimitiveB){return sizedPrimitiveB.serializedSize-sizedPrimitiveA.serializedSize});var trimmedSize=serializedSize;var maxDroppedValueIndex=
-1;for(;maxDroppedValueIndex<sizedPrimitives.length-1&&trimmedSize>maxValueSizeBytes;++maxDroppedValueIndex){var sizedPrimitive=sizedPrimitives[maxDroppedValueIndex+1];var sizeDelta=sizedPrimitive.serializedSize-placeholderSize;if(sizeDelta<=0)break;trimmedSize-=sizeDelta}if(maxDroppedValueIndex===sizedPrimitives.length-1&&trimmedSize>maxValueSizeBytes)return null;var primitiveValueToIndices={};sizedPrimitives.forEach(function(sizedPrimitive,index){primitiveValueToIndices[sizedPrimitive.primitiveValue]=
primitiveValueToIndices[sizedPrimitive.primitiveValue]||[];primitiveValueToIndices[sizedPrimitive.primitiveValue].push(index)});var serializedTrimmedObject=JSON.stringify(object,function(key,value){var indices=primitiveValueToIndices[value];if(indices!==void 0&&(indices.length>0&&indices[0]<=maxDroppedValueIndex)){indices.shift();return droppedValuePlaceholder}return value});return JSON.parse(serializedTrimmedObject)}return{reduceObjectSerializedSize:reduceObjectSerializedSize}}();var userGestureTracker=
function(){var EVENTS=["mousemove","mousedown","mouseup","click","touchstart","touchmove","touchend","pointermove","pointerdown","pointerup"];var eventNameToData={};function getCurrentTime(){return!!window.performance?window.performance.now():Date.now()}function attachTrustedEventListener(eventName,callback){window.addEventListener(eventName,function(event){if(event.isTrusted===false)return;callback(event)},true)}function getRecentGestureData(){return JSON.parse(JSON.stringify(eventNameToData))}EVENTS.forEach(function(eventName){attachTrustedEventListener(eventName,
function(event){var x=event.screenX;var y=event.screenY;if(isNaN(x)||isNaN(y)){var touch=event.touches[0];if(!!touch){x=touch.screenX;y=touch.screenY}}eventNameToData[eventName]={x:x,y:y,time:getCurrentTime()}})});return{getRecentGestureData:getRecentGestureData}}();var visibilityTracker=function(){var INTERSECTION_OBSERVER_THRESHOLD_STEP=0.1;var VISIBILITY_THRESHOLD=0.3;var TRACKING_SUPPORTED="IntersectionObserver"in window&&("IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype);
var observer=null;var intersectionRatio=-1;var visibilityChangeCallback=null;var lastVisibilityToggleTime=getPageFetchStartTime();var totalVisibilityDuration=0;var visibilityDurationAfterImpression=0;function getThresholdSteps(){var thresholdSteps=[];var threshold=0;while(threshold<=1){thresholdSteps.push(threshold);threshold+=INTERSECTION_OBSERVER_THRESHOLD_STEP}return thresholdSteps}function isVisible(){return intersectionRatio>=VISIBILITY_THRESHOLD}function onIntersectionObserved(entries){var wasVisible=
isVisible();var bodyEntry=entries[0];intersectionRatio=bodyEntry.intersectionRatio;var visible=isVisible();var visibilityChanged=wasVisible!==visible;if(visibilityChanged){var now=getTimeSincePageFetchStart();var lastToggleTime=lastVisibilityToggleTime;lastVisibilityToggleTime=now;if(!visible){if(impressionTime!==null)visibilityDurationAfterImpression+=now-Math.max(lastToggleTime,impressionTime);totalVisibilityDuration+=now-lastToggleTime}visibilityChangeCallback(visible)}}function getCurrentIntersectionRatio(){if(!TRACKING_SUPPORTED)return-1;
return intersectionRatio}function getTotalVisibilityDuration(){if(!TRACKING_SUPPORTED)return-1;if(isVisible())return totalVisibilityDuration+getTimeSincePageFetchStart()-lastVisibilityToggleTime;return totalVisibilityDuration}function getVisibilityDurationAfterImpression(){if(!TRACKING_SUPPORTED)return-1;if(impressionTime===null)return 0;if(isVisible())return visibilityDurationAfterImpression+getTimeSincePageFetchStart()-Math.max(lastVisibilityToggleTime,impressionTime);return visibilityDurationAfterImpression}
function setUpIntersectionObserver(onVisibilityChange){if(!TRACKING_SUPPORTED)return;visibilityChangeCallback=onVisibilityChange;intersectionRatio=0;var options={threshold:getThresholdSteps()};observer=new IntersectionObserver(onIntersectionObserved,options);observer.observe(document.body)}return{getCurrentIntersectionRatio:getCurrentIntersectionRatio,getTotalVisibilityDuration:getTotalVisibilityDuration,getVisibilityDurationAfterImpression:getVisibilityDurationAfterImpression,setUpIntersectionObserver:setUpIntersectionObserver}}();
var studioEventsTracker=function(){var loggedEvents=[];var isInitialized=false;function getEventsToTrack(){if(!window.studio)return[];var eventKeys=Object.keys(studio.events.StudioEvent);var eventNames=eventKeys.map(function(eventKey){return studio.events.StudioEvent[eventKey]});return eventNames}function initializeWithEnabler(enablerInstance){var eventsToTrack=getEventsToTrack();eventsToTrack.forEach(function(eventName){enablerInstance.addEventListener(eventName,function(){var eventData={_studioEventName:eventName,
_eventTime:Date.now(),_timeSincePageFetchStart:getTimeSincePageFetchStart()};loggedEvents.push(eventData)})})}function ensureInitialized(){if(isInitialized)return;var enablerInstance=enabler||window.Enabler;if(!enablerInstance){document.addEventListener("DOMContentLoaded",function onDOMLoaded(){document.removeEventListener("DOMContentLoaded",onDOMLoaded);ensureInitialized()});return}isInitialized=true;initializeWithEnabler(enablerInstance)}function getLoggedStudioEvents(){return loggedEvents.slice()}
return{ensureInitialized:ensureInitialized,getLoggedStudioEvents:getLoggedStudioEvents}}();function getPageFetchStartTime(){if(window.performance&&(window.performance.timing&&window.performance.timing.fetchStart))return window.performance.timing.fetchStart;return NaN}function getTimeSincePageFetchStart(){var pageFetchStartTime=getPageFetchStartTime();if(isNaN(pageFetchStartTime))return-1;return Date.now()-pageFetchStartTime}function chunkArray(array,maxChunkLength){if(maxChunkLength<=0)return[array];
var start=0;var chunks=[];while(start<array.length){var chunk=array.slice(start,start+maxChunkLength);start+=chunk.length;chunks.push(chunk)}return chunks}function getEndPoint(){if(endPoint==="")endPoint=test?"https://ads.test.netflix.com/creative":"https://ads.netflix.com/creative";return endPoint}function getLoggerEndPoint(){if(loggerEndPoint==="")loggerEndPoint=test?"https://ichnaea.test.netflix.com/log":"https://ichnaea.netflix.com/log";return loggerEndPoint}function getBackupLocationBase(){if(backupLocationBase===
"")backupLocationBase=test?"https://ae.nflximg.net/":"https://ae.nflximg.net/";return backupLocationBase}function _setEndPoint(overrideEndPoint){endPoint=overrideEndPoint}function _setBackupLocationBase(overrideBackupLocationBase){backupLocationBase=overrideBackupLocationBase}function getResourceTimingEvents(){var logs=[];if(!!window.performance&&!!window.performance.timing){var timing=window.performance.timing;var timingJSON=!!timing.toJSON?timing.toJSON():JSON.parse(JSON.stringify(timing));var payload=
getEventLogPayload("MONET_NAVIGATION_TIMING",timingJSON);logs.push(payload)}if(!!window.performance&&!!window.performance.getEntries){var entries=window.performance.getEntries();entries=entries.map(function(entry){var entryJSON=!!entry.toJSON?entry.toJSON():JSON.parse(JSON.stringify(entry));return getEventLogPayload("MONET_RESOURCE_TIMING",entryJSON)});logs=logs.concat(entries)}return logs}function logAdditionEvents(){var resourceTimingEvents=getResourceTimingEvents();var studioEventDataList=studioEventsTracker.getLoggedStudioEvents();
var studioEvents=studioEventDataList.map(function(studioEventData){return getEventLogPayload("MONET_STUDIO_EVENT",studioEventData)});var allAdditionalEvents=resourceTimingEvents.concat(studioEvents);postEventLogs(allAdditionalEvents)}function loadDynamicAssets(monetRequest){var monet=reqwest({url:getEndPoint()+"?"+monetRequest.encode(),type:"json",method:"get",success:function(response){_log("info","Loaded monet response",response);return response},error:function(xhr,error){_log("error","Failed to load monet response!",
error);return error}});return monet}function loadLocalAssets(monetRequest){return reqwest({url:"local.json",type:"json",method:"get",success:function(response){_log("info","Loaded local response",response);return response},error:function(xhr,error){_log("error","Failed to load local response!",error);return error}})}function setDynamicAssets(dynamicAssets){cachedDynamicAssets=dynamicAssets}var load=function(monetRequest,successCallback,errorCallback){if(!!cachedDynamicAssets){successCallback(cachedDynamicAssets);
return}var creativeLoad=local?loadLocalAssets:loadDynamicAssets;return creativeLoad(monetRequest).then(function(monetResponse){_log("info","Loaded creative from Monet");cachedDynamicAssets=monetResponse;successCallback(monetResponse)}).fail(function(error){_log("warn","Failed to load from Monet!");errorCallback(error)})};var loadFromFile=function(monetRequest,successCallback,errorCallback){var fileURI=_queryString["loadFile"];return reqwest({url:fileURI,type:"json",method:"get",success:function(response){_log("info",
"Loaded monet response",response);if(!!response&&!!response.creative){cachedDynamicAssets=response.creative;successCallback(response.creative)}else{cachedDynamicAssets=response;successCallback(response)}},error:function(xhr,error){_log("error","Failed to load monet response!",error);errorCallback([error])}})};function getEventLogPayload(eventType,eventData){eventData=!eventData?{}:eventData;if(eventData.adId===void 0)eventData.adId=getAdId(enabler);if(eventData.campaignId===void 0)eventData.campaignId=
"campaignId"in _queryString?_queryString["campaignId"]:enabler?enabler.getParameter("buy"):void 0;if(eventData._monetImpressionId===void 0)eventData._monetImpressionId=getMonetImpressionId();if(eventData._eventType===void 0)eventData._eventType=eventType;if(eventData._totalVisibilityDuration===void 0)eventData._totalVisibilityDuration=visibilityTracker.getTotalVisibilityDuration();if(eventData._visibilityDurationAfterImpression===void 0)eventData._visibilityDurationAfterImpression=visibilityTracker.getVisibilityDurationAfterImpression();
if(eventData._eventTime===void 0)eventData._eventTime=Date.now();if(eventData._timeSincePageFetchStart===void 0)eventData._timeSincePageFetchStart=getTimeSincePageFetchStart();if(eventData._local===void 0)eventData._local=local;if(eventData._isExcluded===void 0)eventData._isExcluded=excluded;if(eventData._visibility===void 0)eventData._visibility=visibilityTracker.getCurrentIntersectionRatio();if(eventData._userAgent===void 0&&eventType==="MONET_INITIALIZED")eventData._userAgent=navigator.userAgent;
if(eventData._recentGestureData===void 0&&(eventType==="CLICK"||(eventType==="INTERACTION_EVENT"&&eventData.type==="CLICK"||eventType==="AD_EXIT")))eventData._recentGestureData=userGestureTracker.getRecentGestureData();return eventData}function postEventLogs(eventDataList){eventDataList=eventDataList.filter(function(eventData){var samplingRatio=parseFloat(EventLoggingSamplingRatios[eventData._eventType]);if(isNaN(samplingRatio))return true;return Math.random()<samplingRatio});if(eventDataList.length===
0)return;var eventDataLists=chunkArray(eventDataList,MAX_LOGGED_EVENT_BATCH_LENGTH);return eventDataLists.map(function(eventDataList){var events=eventDataList.map(function(eventData){return{"name":"monetAdTracking","data":eventData}});if(!enabler.isServingInLiveEnvironment())if(eventDataList.length===1)_log("info","Logging to Ichnaea",eventDataList[0]._eventType,eventDataList[0]);else{var types=eventDataList.map(function(val){return val._eventType}).join(",");_log("info","Logging to Ichnaea",types,
eventDataList)}try{events=objectTrimmer.reduceObjectSerializedSize(events,MAX_LOGGING_PAYLOAD_SIZE,"\x3cLARGE_VAL\x3e");if(events===null){_log("warn","failed to trim logging payload",events);return}}catch(e){_log("warn","Error in attempt to limit payload size",e)}return reqwest({url:getLoggerEndPoint(),method:"post",data:JSON.stringify({appName:"monet",events:events}),contentType:"application/json",headers:{"X-Netflix.ichnaea.request.type":"IchnaeaRequest"},success:function(resp){},error:function(err){_log("error",
"Failed to log event to Ichnaea",eventDataList,err)}})})}function logEvent(eventType,eventData){if(eventType==="MONET_IMPRESSION"&&impressionTime===null)impressionTime=getTimeSincePageFetchStart();if(!nflxLog)return;eventData=getEventLogPayload(eventType,eventData);if(!enabler){pendingLogs.push(eventData);return}pendingLogs=pendingLogs.map(function(pendingLog){return getEventLogPayload(null,pendingLog)});var eventDataToLog=[eventData].concat(pendingLogs);pendingLogs=[];postEventLogs(eventDataToLog);
if(eventType==="MONET_IMPRESSION")setTimeout(logAdditionEvents,0)}function logEvents(eventInfoList){if(!nflxLog)return;var eventPayloadList=eventInfoList.map(function(eventInfo){return getEventLogPayload(eventInfo.eventType,eventInfo.eventData)});postEventLogs(eventPayloadList)}function _log(type,msg){if(enabler&&!enabler.isServingInLiveEnvironment()){type=!type?"error":type;var logger=type==="info"?console.log:type==="warn"?console.warn:console.error;if(msg){var args=[];for(var i=1;i<arguments.length;i++)args[args.length]=
arguments[i];logger.bind(console)(args)}}}function overrideBoolFromContext(_queryString,param,defaultValue){if(param in _queryString)if(_queryString[param]==="true")return true;else if(_queryString[param]==="false")return false;return defaultValue}function loadContext(){_queryString=getUrlParams();test=overrideBoolFromContext(_queryString,"test",test);nflxLog=overrideBoolFromContext(_queryString,"nflxLog",nflxLog);excluded=overrideBoolFromContext(_queryString,"excluded",excluded);var doubleClickParamString=
enabler.getAdParameters();var enablerAdParams=getUrlParams(doubleClickParamString);var exitEvents=enablerAdParams["exitEvents"];if(exitEvents)exitEvents.split(",").map(function(exitEventEntry){var fields=exitEventEntry.split(":");if(fields.length>1&&fields[0]==="url"){var clickThroughURL=fields[1];var parsedClickThroughURL=getUrlParams(decodeURIComponent(clickThroughURL));for(var attr in parsedClickThroughURL)enablerAdParams[attr]=parsedClickThroughURL[attr]}});var exitSuffix=enablerAdParams["exit_suffix"];
if(exitSuffix)exitSuffix.split("\x26").map(function(kvp){var pair=kvp.split("\x3d");if(pair.length==2)enablerAdParams[pair[0]]=pair[1]});enablerAdParams["originalAdParams"]=doubleClickParamString;_enablerAdParams=enablerAdParams}function getAdId(enabler){return"adId"in _queryString?_queryString["adId"]:enabler?enabler.getDartAdId():void 0}function patchEnabler(enablerInstance){var MONET_IMPRESSION_ID_PARAM_NAME="monetImpressionId";var AD_ID_PARAM_NAME="adId";var appendInfoToExitURL=function(exitURL,
enabler){if(!exitURL)return exitURL;var impressionId=getMonetImpressionId();var adId=getAdId(enabler);if(!!impressionId){exitURL=addOrUpdateURLParameter(exitURL,MONET_IMPRESSION_ID_PARAM_NAME,impressionId);exitURL=addOrUpdateURLParameter(exitURL,AD_ID_PARAM_NAME,adId)}return exitURL};var originalExitOverride=enablerInstance.exitOverride;enablerInstance.exitOverride=function(id,url){url=appendInfoToExitURL(url,enablerInstance);return originalExitOverride.call(this,id,url)};var originalExit=enablerInstance.exit;
enablerInstance.exit=function(id,url){url=appendInfoToExitURL(url,enablerInstance);return originalExit.call(this,id,url)};var originalExitQueryString=enablerInstance.exitQueryString;enablerInstance.exitQueryString=function(id,queryString){queryString=queryString||"";queryString+=MONET_IMPRESSION_ID_PARAM_NAME+"\x3d"+encodeURIComponent(getMonetImpressionId());return originalExitQueryString.call(this,id,queryString)}}function initialize(enablerInstance,options){if(enabler===enablerInstance)return;enabler=
enablerInstance;patchEnabler(enabler);if(options){if("env"in options&&options.env==="test")_log("warn","Injection of 'test' option has been removed. Please set \x26test\x3dtrue in the query string");if(options.local===true){_log("warn","Monet Creative is being evaluated in local mode!");local=true}if(options.nflxLog===false)nflxLog=false;if(options.excluded===true)excluded=true;var overrides=options.overrides;if(overrides&&typeof overrides==="object"){if("endPoint"in overrides)_setEndPoint(overrides.endPoint);
if("backupLocation"in overrides)_setBackupLocationBase(overrides.backupLocation);if("loggerEndPoint"in overrides)_setEndPoint(overrides.loggerEndPoint)}}loadContext();if("loadFile"in _queryString)Monet.load=loadFromFile;serverCacheBust=_queryString["cb"];try{visibilityTracker.setUpIntersectionObserver(function(isVisible){logEvent(isVisible?"MONET_AD_VISIBLE":"MONET_AD_INVISIBLE")})}catch(e){_log("warn","Monet visibility tracking setup failed",e)}try{studioEventsTracker.ensureInitialized()}catch(e){_log("warn",
"Monet studio events tracking setup failed",e)}var callbacks=pendingInitCallbacks.slice();pendingInitCallbacks=[];callbacks.forEach(function(callback){try{callback()}catch(e){_log("error","Init callback threw error",e)}});_log("info","Monet initialized")}function onInitialized(callback){if(!!enabler){callback();return}pendingInitCallbacks.push(callback)}function _generateUUID(){var d=(new Date).getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*
16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&3|8).toString(16)});return uuid}function _getCookie(cname){var name=cname+"\x3d";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1);if(c.indexOf(name)==0)return c.substring(name.length,c.length)}return""}function getMonetImpressionId(){if(!monetImpressionId||monetImpressionId==""){if("monetImpId"in _queryString)monetImpressionId=_queryString["monetImpId"];else monetImpressionId=_generateUUID();
_log("info","Monet Impression ID : "+monetImpressionId)}return monetImpressionId}function getUniqueUserId(){var dcuid="dcuid"in _queryString?_queryString["dcuid"]:_enablerAdParams["dcuid"];var matchCode=enabler.getParameter("matchcode");if(!matchCode){setTimeout(function(){logEvent("MONET_MATCH_CODE_UNAVAILABLE")},0);return dcuid}if(matchCode!==dcuid)setTimeout(function(){logEvent("MONET_MATCH_CODE_DCUID_MISMATCH",{matchCode:matchCode,dcuid:dcuid})},0);return matchCode}function _getPlacementInformation(enabler){var placement=
new PlacementInformation;placement.siteId="siteId"in _queryString?_queryString["siteId"]:enabler.getDartSiteId();placement.placementId="placementId"in _queryString?_queryString["placementId"]:enabler.getDartPageId();placement.adId=getAdId(enabler);placement.creativeId="creativeId"in _queryString?_queryString["creativeId"]:enabler.getDartCreativeId();placement.campaignId="campaignId"in _queryString?_queryString["campaignId"]:enabler.getParameter("buy");placement.advertiserId="advertiserId"in _queryString?
_queryString["advertiserId"]:enabler.getParameter("adv");placement.auctionId="auctionId"in _queryString?_queryString["auctionId"]:enabler.getParameter("auid");placement.networkId="networkId"in _queryString?_queryString["networkId"]:_enablerAdParams["dcnid"];return placement}function _getTargetingInformation(enabler){var targeting=new TargetingInformation;targeting.dblClickId=getUniqueUserId();targeting.adServeURL="adServeURL"in _queryString?_queryString["adServeURL"]:getAdServeUrl();targeting.userBandwidth=
"bw"in _queryString?_queryString["bw"]:enabler.getUserBandwidth();targeting.userCountry="country"in _queryString?_queryString["country"]:enabler.getUserCountry();targeting.userDMACode="dmaCode"in _queryString?_queryString["dmaCode"]:enabler.getUserDMACode();targeting.userState="state"in _queryString?_queryString["state"]:enabler.getUserState();targeting.userZipCode="zip"in _queryString?_queryString["zip"]:enabler.getUserZipCode();targeting.city="city"in _queryString?_queryString["city"]:enabler.getParameter("city");
return targeting}function getUrlParams(url){var re=/(?:\?|&(?:amp;)?)([^=&#]+)(?:=?([^&#]*))/g,match,params={},decode=function(s){return decodeURIComponent(s.replace(/\+/g," "))};if(typeof url=="undefined")url=document.location.href;while(match=re.exec(url))params[decode(match[1])]=decode(match[2]);return params}function _getOtherInformation(enabler){var other=new OtherInformation;other.iframeURL=window.location.href;other.mqso=_enablerAdParams["mqso"];other.siteName=enabler.getDartSiteName();other.renderingId=
enabler.getDartRenderingId();other.networkString=_enablerAdParams["sn"];other.auId=enabler.getParameter("auid");other.sUrl=enabler.getParameter("surl");other.adSiteUrl=enabler.getParameter("adSiteUrl");return other}function getAdServeUrl(){var sUrl=enabler.getParameter("surl");if(!sUrl||(sUrl==="${SOURCE_URL_ENC}"||sUrl==="${NB_PAGEURL_ENC}"))return _enablerAdParams["adSiteUrl"];return decodeURIComponent(sUrl)}function PlacementInformation(){this.siteId=0;this.placementId=0;this.adId=0;this.creativeId=
0;this.campaignId=0;this.advertiserId=0;this.auctionId="";this.networkId=0;this.encode=function(){var params=[];if(!this)return;if(this.siteId&&!isNaN(this.siteId))params.push("siteId\x3d"+this.siteId);if(this.placementId&&!isNaN(this.placementId))params.push("placementId\x3d"+this.placementId);if(this.adId&&!isNaN(this.adId))params.push("adId\x3d"+this.adId);if(this.creativeId&&!isNaN(this.creativeId))params.push("creativeId\x3d"+this.creativeId);if(this.campaignId&&!isNaN(this.campaignId))params.push("campaignId\x3d"+
this.campaignId);if(this.advertiserId&&!isNaN(this.advertiserId))params.push("advertiserId\x3d"+this.advertiserId);if(this.auctionId)params.push("auctionId\x3d"+this.auctionId);if(this.networkId&&!isNaN(this.networkId))params.push("networkId\x3d"+this.networkId);return params.join("\x26")}}function TargetingInformation(){this.dblClickId="";this.userBandwidth=0;this.userCountry="";this.userDMACode=0;this.userState="";this.userZipCode="";this.adServeURL="";this.encode=function(){if(!this)return;var params=
[];if(this.dblClickId)params.push("dcuid\x3d"+this.dblClickId);if(this.userBandwidth&&!isNaN(this.userBandwidth))params.push("bw\x3d"+this.userBandwidth);if(this.userCountry)params.push("country\x3d"+this.userCountry);if(this.city)params.push("city\x3d"+this.city);if(this.userDMACode&&!isNaN(this.userDMACode))params.push("dmaCode\x3d"+this.userDMACode);if(this.userState)params.push("state\x3d"+this.userState);if(this.userZipCode)params.push("zip\x3d"+this.userZipCode);if(this.adServeURL)params.push("adServeURL\x3d"+
this.adServeURL);return params.join("\x26")}}function OtherInformation(){this.iframeURL="";this.mqso="";this.siteName="";this.renderingId=0;this.networkString="";this.auId="";this.sUrl="";this.encode=function(){if(!this)return;var params=[];if(this.iframeURL)params.push("iframeURL\x3d"+this.iframeURL);if(this.mqso)params.push("mqso\x3d"+this.mqso);if(this.siteName)params.push("siteName\x3d"+this.siteName);if(this.renderingId)params.push("renderingId\x3d"+this.renderingId);if(this.networkString)params.push("networkString\x3d"+
this.renderingId);if(this.auctionId)params.push("auId\x3d"+this.auId);if(this.networkString)params.push("sUrl\x3d"+this.sUrl);return params.join("\x26")}}function MonetRequest(){this.monetImpressionId=getMonetImpressionId();this.placementInfo=new PlacementInformation;this.targetingInfo=new TargetingInformation;this.otherInfo=new OtherInformation;this.encode=function(){if(!this)return;var params=[];var requestCacheBuster=Math.round((new Date).getTime()/1E3);var placementEncode=this.placementInfo.encode();
var targetingEncode=this.targetingInfo.encode();if(this.monetImpressionId)params.push("monetImpressionId\x3d"+this.monetImpressionId);if(serverCacheBust)params.push("cb\x3dtrue");if(placementEncode)params.push(placementEncode);if(targetingEncode)params.push(targetingEncode);params.push("rand\x3d"+requestCacheBuster);if(excluded)params.push("excluded\x3dtrue");if("adServeUTC"in _queryString)params.push("adServeUTC\x3d"+_queryString["adServeUTC"]);return params.join("\x26")}}function getPopulatedMonetRequest(){var request=
new MonetRequest;request.placementInfo=_getPlacementInformation(enabler);request.targetingInfo=_getTargetingInformation(enabler);request.otherInfo=_getOtherInformation(enabler);return request}function buildMonetRequest(){var request=getPopulatedMonetRequest();var adParams=JSON.parse(JSON.stringify(_enablerAdParams));delete adParams.CREATIVE_PARAMETER_ASSETS_DATA;logEvent("BUILD_MONET_REQUEST",{"enablerAdParams":adParams,"monetRequest":request});return request}function getComponentLocale(component){if(!cachedDynamicAssets){_log("warn",
"getComponentLocale called before dynamic assets were loaded, default returned");return DEFAULT_COMPONENT_LOCALE}if(!cachedDynamicAssets.localizations){_log("warn","malformed cached dynamic assets, missing 'localizations' field, default returned");return DEFAULT_COMPONENT_LOCALE}for(var locale in cachedDynamicAssets.localizations){if(!cachedDynamicAssets.localizations.hasOwnProperty(locale))continue;var componentsForLocale=cachedDynamicAssets.localizations[locale];var localeHasComponent=componentsForLocale.indexOf(component);
if(localeHasComponent>=0)return locale==="DEFAULT"?DEFAULT_COMPONENT_LOCALE:locale}_log("warn","localization not found for component, default returned",component);return DEFAULT_COMPONENT_LOCALE}function setUpGlobalErrorHandling(){var MAX_LOGS_PER_ERROR=5;var errorHashToLogCount={};window.addEventListener("error",function(errorEvent){try{var data={message:errorEvent.message,filename:errorEvent.filename,lineno:errorEvent.lineno,colno:errorEvent.colno,stack:errorEvent.error&&errorEvent.error.stack?
errorEvent.error.stack.toString():null};var errorHash=JSON.stringify(data);var logCount=errorHashToLogCount[errorHash]||0;if(logCount>MAX_LOGS_PER_ERROR){var logToConsole=Math.random()<0.05;if(logToConsole)_log("error",errorEvent);return}++logCount;errorHashToLogCount[errorHash]=logCount;logEvent("MONET_UNCAUGHT_ERROR",data)}catch(e){try{_log("warn","Error while trying to handle uncaught exception",e)}catch(ee){}}})}function preInitialize(){try{studioEventsTracker.ensureInitialized()}catch(e){_log("warn",
"Monet studio events tracking setup failed",e)}try{studio.Enabler.setRushSimulatedLocalEvents(true)}catch(e){_log("warn","Monet setRushSimulatedLocalEvents setup failed",e)}try{setUpGlobalErrorHandling()}catch(e){_log("warn","setting up global error handling failed")}}preInitialize();return{initialize:initialize,buildMonetRequest:buildMonetRequest,load:load,loadDynamicAssets:loadDynamicAssets,logEvent:logEvent,logEvents:logEvents,onInitialized:onInitialized,getComponentLocale:getComponentLocale,getEndPoint:getEndPoint,
getMonetImpressionId:getMonetImpressionId,getLoggerEndPoint:getLoggerEndPoint,getBackupLocationBase:getBackupLocationBase,getPopulatedMonetRequest:getPopulatedMonetRequest,setDynamicAssets:setDynamicAssets}}();